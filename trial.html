<!DOCTYPE html>
<html>
<head>
<style>
 #canvas {
    border:1px solid #dfdfdf;
    position:absolute;
}
#inner{
    position:absolute;
    z-index: 10;
}
</style>
</head>
<body>
<canvas id="canvas">
</canvas>
<canvas id="inner"></canvas>
<script>
var canvas = document.getElementById("canvas");
var inner = document.getElementById("inner");
var ctx= canvas.getContext("2d");
var context = inner.getContext("2d");
var time, newTime;
var img = new Image();
img.src="game-background.jpg";
var bob = new Image();
bob.src = "bob2.png";
canvas.height = "550";
canvas.width = "1400";
inner.height = "500";
inner.width = "1400";
img.width = "500";
img.height = "400";
bob.style.zIndex= "10";
img.addEventListener("load",drawImage);
bob.addEventListener("load",drawMan);
window.requestAnimationFrame(render);
var speed =-4;
var x=0,i=0,y=0,j=0,count=0;
var request1,request2;
function render(){
	drawImage();
	drawMan();
	request1=window.requestAnimationFrame(render);
}
function drawImage()
{
setTimeout(function(){
time=window.performance.now();
ctx.rect(0,0,1400,550);
ctx.drawImage(img,0,0);
var pat = ctx.createPattern(img,"repeat-x");
ctx.fillStyle =pat;
ctx.fill();
ctx.translate(speed,0);
newTime=window.performance.now()-time;
},newTime);
}
function drawMan(){
   if(i%3==0)
   {
   sourceX = x*165;
   sourceY = y*292.57;
   context.clearRect(0,180,165,292.57);
   context.rect(0,180,165,292.57);
   context.drawImage(bob, sourceX, sourceY,165 , 292.57, 0, 180, 165, 292.57);
   x++;
   if(x==12)
   {
      x=0;
      j++;
      if(j%2==0)
      	y=1;
      else
      	y=0;
   }
}
i++;
}
function jumpMan()
{
if(i%3==0)
   {
   sourceX = x*165;
   sourceY = y*292.57;
   context.clearRect(0,180,165,292.57);
   context.rect(0,180,165,292.57);
   context.drawImage(bob, sourceX, sourceY,165 , 292.57, 0, 180, 165, 292.57);
   x++;
   if(x==12)
   {
      x=0;
      j++;
      if(j%2==0)
      	y=4;
      else
      	y=3;
   }
   context.translate(-speed,0);
}
i++;
}
function render2(){
	if(count<=24)
	{
		drawImage();
		jumpMan();
		request2=window.requestAnimationFrame(render2);
		count++;
	}
	else{
		y=0;
		j=0;
		context.translate(0,0);
		window.cancelAnimationFrame(request2);
		render();
	}
}
document.body.onkeyup=function(e){
	if(e.keyCode==32)
	{
		count=0;
		y=3;
		j=0;
	  window.cancelAnimationFrame(request1);
	  render2();
	}
}
</script>
</body>
</html>
